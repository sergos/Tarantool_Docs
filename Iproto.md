# Iproto #

У Tarantool есть один транзакционный тред TX. Для того
чтобы работать с сетью (сокет, TCP), существует отдельный тред -- iproto.
Iproto принимает запросы из сети, обрабатывает протокол Tarantool,
передаёт запрос в TX и запускает пользовательский запрос в отдельном
файбере.

Рассмотрим как происходит общение между TX и Iproto тредами. В греческой
мифологии Харон -- это перевозчик душ умерших через реку Стикс, отделяюшую
мир живых от мира мертвых.

Здесь:

* Харон -- с помощью cbus message уведомляет iproto тред о новых данных
    в obuf и возвращает в tx тред позицию в obuf, которая была успешно
    сброшена в сеть.

* река Стикс -- cpipe;
* лодка -- cbus message;
* мир живых -- TX тред;
* мир мертвых -- iproto тред

(Пока такая картинка, чуть позже сделаю анимацию)
![Iproto Kharon](/images/iproto_kharon.jpg)

На gif'ке изображено следующее: cbus message инициируется в тот момент
когда данные появляются в TX треде. Далее с помощью cbus message данные
передаются в iproto тред. Часть данных из iproto сбрасывается в сеть, т.е.
меняется wpos у obuf, соответсвенно это новое знвчение передается в TX тред
посредством cbus message. Аналогично делается и для ibuf только в другую
сторону (из iproto в TX)

### Todo

- [ ] Сделать гифку
- [ ] Расписать и нарисовать про obuf и ibuf + двойная буферизация
- [ ] Сделать замечание про multithread iproto https://github.com/tarantool/tarantool/issues/5645

### In Progress

- [ ] Архитектура iproto глобально
